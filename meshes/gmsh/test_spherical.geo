SetFactory("OpenCASCADE");
//Starting with a box of length = 1
Box(1) = {0, 0, 0, 1, 1, 1};
x = 0; y = 0; z = 0; 
//-----------------------------------------------------------------------------------------------------------------------
//Copy in the section below the geometric information generated from the pre-processing module in meshes/txt_mesh/
//The geometric information starts from the first line until
//this line -> v() = BooleanFragments { Volume{1}; Delete; }{ Volume{2:n}; Delete; };
//-----------------------------------------------------------------------------------------------------------------------
Sphere(2) = {x+0.43515280174620286, y+0.3653115883818032, z+0.7272055361031804, 0.11882144863681315}; 
Sphere(3) = {x+0.18638662341076584, y+0.198823517024234, z+0.5468541660393013, 0.11831020288445879}; 
Sphere(4) = {x+0.8589929737074843, y+0.5680800552823532, z+0.5058752657122533, 0.11742493363145311}; 
Sphere(5) = {x+0.4139783193901687, y+0.6659619613775019, z+0.2004554450006911, 0.11706785979202208}; 
Sphere(6) = {x+0.1451495507355191, y+0.8065830821793517, z+0.8819392095205639, 0.11705728655704563}; 
Sphere(7) = {x+0.5984561194306379, y+0.6840703119889594, z+0.6683102957918005, 0.11629996214660678}; 
Sphere(8) = {x+0.27840653637958634, y+0.548148008157205, z+0.6767511592095233, 0.11603373223140992}; 
Sphere(9) = {x+0.4782049318990659, y+0.15774399978578724, z+0.8710202392788619, 0.1154028334817767}; 
Sphere(10) = {x+0.853487703788147, y+0.14530752301824162, z+0.7164380411044261, 0.1153871307130473}; 
Sphere(11) = {x+0.42498938219502796, y+0.8802422587747096, z+0.3605468849041209, 0.11501561705735942}; 
Sphere(12) = {x+0.30887397131693844, y+0.24259934089054147, z+0.29776786656610554, 0.11472941079270914}; 
Sphere(13) = {x+0.6572817497109871, y+0.207504719319637, z+0.38648935986611377, 0.11460588543346645}; 
Sphere(14) = {x+0.7486143920975412, y+0.8077825605672107, z+0.15220899333129406, 0.11344814983289048}; 
Sphere(15) = {x+0.5877222355224437, y+0.5634603749797609, z+0.37362568641604144, 0.1133433135754856}; 
Sphere(16) = {x+0.21031352135011527, y+0.49786892357284884, z+0.28883218310935727, 0.1133303496606433}; 
Sphere(17) = {x+0.4245845638290573, y+0.873407773932891, z+0.8525200465737589, 0.11325675281689421}; 
Sphere(18) = {x+0.8634230726075187, y+0.8525774853889503, z+0.7402804767915656, 0.11297318565349174}; 
Sphere(19) = {x+0.8600087258767966, y+0.5320898222520731, z+0.7738269813774931, 0.1127094493735399}; 
Sphere(20) = {x+0.5995444416806263, y+0.44134398937171243, z+0.5806105902812893, 0.11262161373976298}; 
Sphere(21) = {x+0.16684684260004679, y+0.8195372386847769, z+0.25658886265848935, 0.1121013407273069}; 
Sphere(22) = {x+0.1686161315980179, y+0.1200112645666342, z+0.8185723356956465, 0.11204581912904649}; 
Sphere(23) = {x+0.5649486510327432, y+0.5918094711065693, z+0.8803843113113999, 0.11085375237764528}; 
Sphere(24) = {x+0.4401653928452681, y+0.22028758802320317, z+0.5392193540248881, 0.11004661349977261}; 
Sphere(25) = {x+0.7115879837688547, y+0.8116457311661255, z+0.41938325923971265, 0.1091531075705898}; 
Sphere(26) = {x+0.1504271995799442, y+0.19051196350500493, z+0.14533612594751538, 0.10899153484746134}; 
Sphere(27) = {x+0.717215942700342, y+0.45746250130244964, z+0.2007533803593764, 0.1089363523775665}; 
Sphere(28) = {x+0.2512257384973052, y+0.7658871098887022, z+0.5124133903325411, 0.1088775424578148}; 
Sphere(29) = {x+0.5780944140780193, y+0.18617296654076776, z+0.1651456048886457, 0.10783258172979332}; 
Sphere(30) = {x+0.8795188824307212, y+0.5960368454408622, z+0.11877233377842036, 0.10738290369528218}; 
Sphere(31) = {x+0.19760017832813248, y+0.3963630605621685, z+0.8540355169321368, 0.10691579860108459}; 
Sphere(32) = {x+0.8628605272761387, y+0.10963069512133831, z+0.4655076412654414, 0.10666559140631203}; 
Sphere(33) = {x+0.8118676023828733, y+0.2581768631907012, z+0.18563963148912407, 0.10543683718502544}; 
Sphere(34) = {x+0.37724019556788224, y+0.44146419503950296, z+0.5023198867216512, 0.10451228743177304}; 
Sphere(35) = {x+0.8424102817453174, y+0.2790129969533238, z+0.8922342128364676, 0.10397680504887621}; 
Sphere(36) = {x+0.8272366112780747, y+0.3252300769076406, z+0.5474058651216485, 0.10378716633897989}; 
Sphere(37) = {x+0.6708764285077349, y+0.2605883349293143, z+0.7636099563633094, 0.10355301005565604}; 
Sphere(38) = {x+0.3591872183623664, y+0.45370401917054853, z+0.11068353116980492, 0.10267048136043772}; 
Sphere(39) = {x+0.6351661873113412, y+0.11343825952218846, z+0.5907215511542543, 0.10228612353337661}; 
Sphere(40) = {x+0.11148890538305063, y+0.8364567670964432, z+0.6634124292773329, 0.10139100984920472}; 
Sphere(41) = {x+0.10262113284028476, y+0.604654607952612, z+0.5348567660501957, 0.10036406367867426}; 
Sphere(42) = {x+0.3744898356615842, y+0.872421936479853, z+0.1264940976976821, 0.10015788849815448}; 
Sphere(43) = {x+0.6903754930205311, y+0.8772139588242504, z+0.8717144588987542, 0.10015514552685538}; 
Sphere(44) = {x+0.1683584088643768, y+0.6478258677091101, z+0.12270163875468032, 0.10004636150486554}; 
Sphere(45) = {x+0.4969979518342206, y+0.35946316900540687, z+0.35606567648573295, 0.10001714994438957}; 
v() = BooleanFragments { Volume{1}; Delete; }{ Volume{2 :45}; Delete; };
//-----------------------------------------------------------------------------------------------------------------------
// STL mesh for bounding boxes:
Geometry.OCCBoundsUseStl = 1;
eps = 1e-3;
//volumes in the bounding box of the original box
vin() = Volume In BoundingBox {-eps,-eps,-eps, 1+eps,1+eps,1+eps};
v() -= vin();
//Deleting the volumes outside the volume of the origina box
Recursive Delete{ Volume{v()}; }
//--------------------------------------------------------------------------------------
//For applying periodic boundaries
//We get all surfaces on the left:
Sxmin() = Surface In BoundingBox{-eps, -eps, -eps, +eps, 1+eps, 1+eps};
For i In {0:#Sxmin()-1}
  // We get the bounding box of the left surfaces
  bb() = BoundingBox Surface { Sxmin(i) };
  // We translate the bounding box to the right and look for surfaces inside i
  Sxmax() = Surface In BoundingBox { bb(0)-eps+1, bb(1)-eps, bb(2)-eps,
                                     bb(3)+eps+1, bb(4)+eps, bb(5)+eps };
  // For all the matches, we compare the corresponding bounding boxes
  For j In {0:#Sxmax()-1}
    bb2() = BoundingBox Surface { Sxmax(j) };
    bb2(0) -= 1;
    bb2(3) -= 1;
    // if they match, we apply the periodicity constraint
    If(Fabs(bb2(0)-bb(0)) < eps && Fabs(bb2(1)-bb(1)) < eps &&
       Fabs(bb2(2)-bb(2)) < eps && Fabs(bb2(3)-bb(3)) < eps &&
       Fabs(bb2(4)-bb(4)) < eps && Fabs(bb2(5)-bb(5)) < eps)
      Periodic Surface {Sxmax(j)} = {Sxmin(i)} Translate {1,0,0};
    EndIf
  EndFor
EndFor

//We get all surfaces on the outside:
Symin() = Surface In BoundingBox{-eps, -eps, -eps, 1+eps, eps, 1+eps};
For i In {0:#Symin()-1}
  // We get the bounding box of each outter surface
  bb() = BoundingBox Surface { Symin(i) };
  // We translate the bounding box to the inside and look for surfaces inside i
  Symax() = Surface In BoundingBox { bb(0)-eps, bb(1)-eps+1, bb(2)-eps,
                                     bb(3)+eps, bb(4)+eps+1, bb(5)+eps };
  // For all the matches, we compare the corresponding bounding boxes
  For j In {0:#Symax()-1}
    bb2() = BoundingBox Surface { Symax(j) };
    bb2(1) -= 1;
    bb2(4) -= 1;
    // if they match, we apply the periodicity constraint
    If(Fabs(bb2(0)-bb(0)) < eps && Fabs(bb2(1)-bb(1)) < eps &&
       Fabs(bb2(2)-bb(2)) < eps && Fabs(bb2(3)-bb(3)) < eps &&
       Fabs(bb2(4)-bb(4)) < eps && Fabs(bb2(5)-bb(5)) < eps)
      Periodic Surface {Symax(j)} = {Symin(i)} Translate {0,1,0};
    EndIf
  EndFor
EndFor

// We get all surfaces on the bottom:
Szmin() = Surface In BoundingBox{-eps, -eps, -eps, 1+eps, 1+eps, +eps};

For i In {0:#Szmin()-1}
  // We get the bounding box of each bottom surface
  bb() = BoundingBox Surface { Szmin(i) };
  // We translate the bounding box to the top and look for surfaces inside i
  Szmax() = Surface In BoundingBox { bb(0)-eps, bb(1)-eps, bb(2)-eps+1,
                                     bb(3)+eps, bb(4)+eps, bb(5)+eps+1 };
  // For all the matches, we compare the corresponding bounding boxes
  For j In {0:#Szmax()-1}
    bb2() = BoundingBox Surface { Szmax(j) };
    bb2(2) -= 1;
    bb2(5) -= 1;
    // ...and if they match, we apply the periodicity constraint
    If(Fabs(bb2(0)-bb(0)) < eps && Fabs(bb2(1)-bb(1)) < eps &&
       Fabs(bb2(2)-bb(2)) < eps && Fabs(bb2(3)-bb(3)) < eps &&
       Fabs(bb2(4)-bb(4)) < eps && Fabs(bb2(5)-bb(5)) < eps)
      Periodic Surface {Szmax(j)} = {Szmin(i)} Translate {0,0,1};
    EndIf
  EndFor
EndFor
//---------------------------------------------------------------------------------------------------------------------------------------
//In this section we copy the rest of the information gathered from the file generated from the pre-processing module in meshes/txt_mesh/
//---------------------------------------------------------------------------------------------------------------------------------------
Physical Volume(1) = {46}; 
Physical Volume(2) = {2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45}; 
Mesh.CharacteristicLengthMin = 0.07; 
Mesh.CharacteristicLengthMax = 0.07;
//------------------------------------------------------------------------------------------------------------------------------------------
